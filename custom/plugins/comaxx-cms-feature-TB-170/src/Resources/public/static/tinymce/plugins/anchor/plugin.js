!function(){"use strict";var n=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),e=tinymce.util.Tools.resolve("tinymce.util.Tools"),o="a:not([href])",r=function(n){return!n},a=function(n){return n.getAttribute("id")||n.getAttribute("name")||""},i=function(n){return n&&"a"===n.nodeName.toLowerCase()&&!n.getAttribute("href")&&""!==a(n)},c=function(n){var o=n.dom;t(o).walk(n.selection.getRng(),function(n){e.each(n,function(n){i(n)&&!n.firstChild&&o.remove(n,!1)})})},l=function(n){return n.dom.getParent(n.selection.getStart(),o)},u=function(n){var t=l(n);return t?a(t):""},d=function(n,t){n.undoManager.transact(function(){n.getParam("allow_html_in_named_anchor",!1,"boolean")||n.selection.collapse(!0),n.selection.isCollapsed()?n.insertContent(n.dom.createHTML("a",{id:t})):(c(n),n.formatter.remove("namedAnchor",null,null,!0),n.formatter.apply("namedAnchor",{value:t}),n.addVisual())})},s=function(n,t,e){e.removeAttribute("name"),e.id=t,n.addVisual(),n.undoManager.add()},m=function(n,t){var e=l(n);e?s(n,t,e):d(n,t),n.focus()},f=function(n){var t=u(n);n.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:t},onSubmit:function(t){var e,o;e=n,o=t.getData().id,(/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(o)?(m(e,o),0):(e.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),1))||t.close()}})},h=function(n){n.addCommand("mceAnchor",function(){f(n)})},g=function(n){return function(t){for(var e=0;e<t.length;e++){var o,a=t[e];(o=a)&&r(o.attr("href"))&&!r(o.attr("id")||o.attr("name"))&&!o.firstChild&&a.attr("contenteditable",n)}}},v=function(n){n.on("PreInit",function(){n.parser.addNodeFilter("a",g("false")),n.serializer.addNodeFilter("a",g(null))})},p=function(n){n.formatter.register("namedAnchor",{inline:"a",selector:o,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:function(n,t,e){return i(n)}})},b=function(n){n.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:function(){return n.execCommand("mceAnchor")},onSetup:function(t){return n.selection.selectorChangedWithUnbind("a:not([href])",t.setActive).unbind}}),n.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:function(){return n.execCommand("mceAnchor")}})};n.add("anchor",function(n){v(n),h(n),b(n),n.on("PreInit",function(){p(n)})})}();