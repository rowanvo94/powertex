!function(){"use strict";function e(e){return e.getAttribute("id")||e.getAttribute("name")||""}function t(t){return t&&"a"===t.nodeName.toLowerCase()&&!t.getAttribute("href")&&""!==e(t)}function n(e){return e.dom.getParent(e.selection.getStart(),l)}function o(e){return function(t){for(var n=0;n<t.length;n++){var o=t[n],a=void 0;!(!(a=o)||a.attr("href"))&&(a.attr("id")||a.attr("name"))&&!o.firstChild&&o.attr("contenteditable",e)}}}var a=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),l="a:not([href])";a.add("anchor",function(a){a.on("PreInit",function(){a.parser.addNodeFilter("a",o("false")),a.serializer.addNodeFilter("a",o(null))}),a.addCommand("mceAnchor",function(){var o,l;l=(o=n(a))?e(o):"",a.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:l},onSubmit:function(e){var o,l=e.getData().id;(/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(l)?((o=n(a))?(o.removeAttribute("name"),o.id=l,a.addVisual(),a.undoManager.add()):a.undoManager.transact(function(){var e;a.getParam("allow_html_in_named_anchor",!1,"boolean")||a.selection.collapse(!0),a.selection.isCollapsed()?a.insertContent(a.dom.createHTML("a",{id:l})):(r(e=a.dom).walk(a.selection.getRng(),function(n){i.each(n,function(n){t(n)&&!n.firstChild&&e.remove(n,!1)})}),a.formatter.remove("namedAnchor",null,null,!0),a.formatter.apply("namedAnchor",{value:l}),a.addVisual())}),a.focus(),0):(a.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),1))||e.close()}})}),a.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:function(){return a.execCommand("mceAnchor")},onSetup:function(e){return a.selection.selectorChangedWithUnbind("a:not([href])",e.setActive).unbind}}),a.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:function(){return a.execCommand("mceAnchor")}}),a.on("PreInit",function(){a.formatter.register("namedAnchor",{inline:"a",selector:l,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:t})})})}();