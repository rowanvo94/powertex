!function(){"use strict";var t,n,e=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=function(){},o=function(t){return function(){return t}},i=function(t){return t},u=o(!1),c=o(!0),a=function(){return l},l={fold:function(t,n){return t()},isSome:u,isNone:c,getOr:i,getOrThunk:t=function(t){return t()},getOrDie:function(t){throw Error(t||"error: getOrDie called on none.")},getOrNull:o(null),getOrUndefined:o(void 0),or:i,orThunk:t,map:a,each:r,bind:a,exists:u,forall:c,filter:function(){return a()},toArray:function(){return[]},toString:o("none()")},s=function(t){var n=o(t),e=function(){return i},r=function(n){return n(t)},i={fold:function(n,e){return e(t)},isSome:c,isNone:u,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return s(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?i:l},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return i},f={some:s,none:a,from:function(t){return null==t?l:s(t)}},m=function(t,n){for(var e=0,r=t.length;e<r;e++)if(n(t[e],e))return!0;return!1},g=function(t,n){for(var e=t.length,r=Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r},d=function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e],e)},h=function(t){var n=t;return{get:function(){return n},set:function(t){n=t}}},v=function(t,n){var e=null,r=function(){null===e||(clearTimeout(e),e=null)};return{cancel:r,throttle:function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];r(),e=setTimeout(function(){e=null,t.apply(null,o)},n)}}},y=function(t,n){t.insertContent(n)},p=function(){return(p=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},b=Object.keys,O=Object.hasOwnProperty,w=function(t,n){for(var e=b(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}},C=function(t,n){var e={};return w(t,function(t,r){var o=n(t,r);e[o.k]=o.v}),e},A=function(t,n){return O.call(t,n)},k=(n=function(t,n){return n},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)throw Error("Can't merge zero objects");for(var r={},o=0;o<t.length;o++){var i=t[o];for(var u in i)A(i,u)&&(r[u]=n(r[u],i[u]))}return r}),j=function(t){var n=h(f.none()),e=function(){return n.get().each(t)};return{clear:function(){e(),n.set(f.none())},isSet:function(){return n.get().isSome()},get:function(){return n.get()},set:function(t){e(),n.set(f.some(t))}}},_=function(){var t=j(r);return p(p({},t),{on:function(n){return t.get().each(n)}})},T=function(t,n){return -1!==t.indexOf(n)},x=tinymce.util.Tools.resolve("tinymce.Resource"),P=tinymce.util.Tools.resolve("tinymce.util.Delay"),D=tinymce.util.Tools.resolve("tinymce.util.Promise"),S=function(t,n){var e=t.getParam("emoticons_database","emojis","string");return t.getParam("emoticons_database_url",n+"/js/"+e+t.suffix+".js","string")},L={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},E=function(t){var n,e;return n=t.getParam("emoticons_append",{},"object"),e=function(t){return p({keywords:[],category:"user"},t)},C(n,function(t,n){return{k:n,v:e(t,n)}})},F=function(t,n,e){var r=_(),o=_(),i=t.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string"),u=function(t){var n={},e=[];w(t,function(t,r){var o,u,c,a={title:r,keywords:t.keywords,char:(o=t.char,""==(u="<img")||o.length>=u.length&&o.substr(0,0+u.length)===u)?t.char.replace(/src="([^"]+)"/,function(t,n){return'src="'+i+n+'"'}):t.char,category:A(L,c=t.category)?L[c]:c},l=void 0!==n[a.category]?n[a.category]:[];n[a.category]=l.concat([a]),e.push(a)}),r.set(n),o.set(e)};t.on("init",function(){x.load(e,n).then(function(n){u(k(n,E(t)))},function(t){console.log("Failed to load emoticons: "+t),r.set({}),o.set([])})});var c=function(){return o.get().getOr([])},a=function(){return r.isSet()&&o.isSet()};return{listCategories:function(){return["All"].concat(b(r.get().getOr({})))},hasLoaded:a,waitForLoad:function(){return a()?D.resolve(!0):new D(function(t,e){var r=15,o=P.setInterval(function(){a()?(P.clearInterval(o),t(!0)):--r<0&&(console.log("Could not load emojis from url: "+n),P.clearInterval(o),e(!1))},100)})},listAll:c,listCategory:function(t){return"All"===t?c():r.get().bind(function(n){return f.from(n[t])}).getOr([])}}},N=function(t,n){return T(t.title.toLowerCase(),n)||m(t.keywords,function(t){return T(t.toLowerCase(),n)})},I=function(t,n,e){for(var r=[],o=n.toLowerCase(),i=e.fold(function(){return u},function(t){return function(n){return n>=t}}),c=0;c<t.length&&!((0===n.length||N(t[c],o))&&(r.push({value:t[c].char,text:t[c].title,icon:t[c].char}),i(r.length)));c++);return r},z="pattern",M=function(t,n){var e={pattern:"",results:I(n.listAll(),"",f.some(300))},r=h("All"),o=function(t){var e=t.getData(),o=r.get(),i=I(n.listCategory(o),e[z],"All"===o?f.some(300):f.none());t.setData({results:i})},i=v(function(t){o(t)},200),u={label:"Search",type:"input",name:z},c={type:"collection",name:"results"},a=function(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:g(n.listCategories(),function(t){return{title:t,name:t,items:[u,c]}})},initialData:e,onTabChange:function(t,n){r.set(n.newTabName),i.throttle(t)},onChange:i.throttle,onAction:function(n,e){"results"===e.name&&(y(t,e.value),n.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},l=t.windowManager.open(a());l.focus(z),n.hasLoaded()||(l.block("Loading emoticons..."),n.waitForLoad().then(function(){l.redial(a()),i.throttle(l),l.focus(z),l.unblock()}).catch(function(t){l.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),l.focus(z),l.unblock()}))},U=function(t,n){t.addCommand("mceEmoticons",function(){return M(t,n)})},R=function(t){t.on("PreInit",function(){t.parser.addAttributeFilter("data-emoticon",function(t){d(t,function(t){t.attr("data-mce-resize","false"),t.attr("data-mce-placeholder","1")})})})},B=function(t,n){t.ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(t,e){return n.waitForLoad().then(function(){return I(n.listAll(),t,f.some(e))})},onAction:function(n,e,r){t.selection.setRng(e),t.insertContent(r),n.hide()}})},q=function(t){var n=function(){return t.execCommand("mceEmoticons")};t.ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:n}),t.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:n})};e.add("emoticons",function(t,n){var e=S(t,n),r=t.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"),o=F(t,e,r);U(t,o),q(t),B(t,o),R(t)})}();