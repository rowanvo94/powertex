!function(){"use strict";function t(){}function n(t){return function(){return t}}function e(t){return t}function o(){return c}var r=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=n(!1),a=n(!0),c={fold:function(t,n){return t()},isSome:i,isNone:a,getOr:e,getOrThunk:u,getOrDie:function(t){throw Error(t||"error: getOrDie called on none.")},getOrNull:n(null),getOrUndefined:n(void 0),or:e,orThunk:u,map:o,each:t,bind:o,exists:i,forall:a,filter:function(){return c},toArray:function(){return[]},toString:n("none()")};function u(t){return t()}function l(t){var n=t;return{get:function(){return n},set:function(t){n=t}}}function s(t,n){for(var e=y(t),o=0,r=e.length;o<r;o++){var i=e[o];n(t[i],i)}}function f(){var n,e=(n=l(h.none()),{clear:function(){o(),n.set(h.none())},isSet:function(){return n.get().isSome()},get:function(){return n.get()},set:function(t){o(),n.set(h.some(t))}});function o(){return n.get().each(t)}return v(v({},e),{on:function(t){return e.get().each(t)}})}function m(t,n){return -1!==t.indexOf(n)}function g(t,n,e){for(var o,r=[],a=n.toLowerCase(),c=e.fold(function(){return i},function(t){return function(n){return t<=n}}),u=0;u<t.length&&(0!==n.length&&!m((o=t[u]).title.toLowerCase(),a)&&!function(t){for(var n=0,e=t.length;n<e;n++)if(m(t[n].toLowerCase(),a))return 1}(o.keywords)||(r.push({value:t[u].char,text:t[u].title,icon:t[u].char}),!c(r.length)));u++);return r}var d=function(t){function e(){return u}function o(n){return n(t)}var r=n(t),u={fold:function(n,e){return e(t)},isSome:a,isNone:i,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:e,orThunk:e,map:function(n){return d(n(t))},each:function(n){n(t)},bind:o,exists:o,forall:o,filter:function(n){return n(t)?u:c},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return u},h={some:d,none:o,from:function(t){return null==t?c:d(t)}},v=function(){return(v=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},y=Object.keys,p=Object.hasOwnProperty,b=function(t,n){var e={};return s(t,function(t,o){var r=n(t,o);e[r.k]=r.v}),e},O=tinymce.util.Tools.resolve("tinymce.Resource"),w=tinymce.util.Tools.resolve("tinymce.util.Delay"),C=tinymce.util.Tools.resolve("tinymce.util.Promise"),A={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},k="pattern";r.add("emoticons",function(t,n){var e,o,r=(e=t.getParam("emoticons_database","emojis","string"),t.getParam("emoticons_database_url",n+"/js/"+e+t.suffix+".js","string")),i=t.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"),a=function(t,n,e){var o=f(),r=f(),i=t.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string");function a(){return r.get().getOr([])}function c(){return o.isSet()&&r.isSet()}return t.on("init",function(){O.load(e,n).then(function(n){var e,a,c,u,l;c=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)throw Error("Can't merge zero objects");for(var e={},o=0;o<t.length;o++){var r,i=t[o];for(r in i)p.call(i,r)&&(e[r]=(e[r],i[r]))}return e}(n,(e=t.getParam("emoticons_append",{},"object"),a=function(t){return v({keywords:[],category:"user"},t)},b(e,function(t,n){return{k:n,v:a(t)}}))),u={},l=[],s(c,function(t,n){var e,o,r,a,c={title:n,keywords:t.keywords,char:(r=t.char).length>=(a="<img").length&&r.substr(0,0+a.length)===a?t.char.replace(/src="([^"]+)"/,function(t,n){return'src="'+i+n+'"'}):t.char,category:(e=o=t.category,p.call(A,e))?A[o]:o},s=void 0!==u[c.category]?u[c.category]:[];u[c.category]=s.concat([c]),l.push(c)}),o.set(u),r.set(l)},function(t){console.log("Failed to load emoticons: "+t),o.set({}),r.set([])})}),{listCategories:function(){return["All"].concat(y(o.get().getOr({})))},hasLoaded:c,waitForLoad:function(){return c()?C.resolve(!0):new C(function(t,e){var o=15,r=w.setInterval(function(){c()?(w.clearInterval(r),t(!0)):--o<0&&(console.log("Could not load emojis from url: "+n),w.clearInterval(r),e(!1))},100)})},listAll:a,listCategory:function(t){return"All"===t?a():o.get().bind(function(n){return h.from(n[t])}).getOr([])}}}(t,r,i);function c(){return o.execCommand("mceEmoticons")}t.addCommand("mceEmoticons",function(){return function(t,n){var e,o,r={pattern:"",results:g(n.listAll(),"",h.some(300))},i=l("All"),a=(e=function(t){var e=t.getData(),o=i.get(),r=g(n.listCategory(o),e[k],"All"===o?h.some(300):h.none());t.setData({results:r})},o=null,{cancel:c,throttle:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];c(),o=setTimeout(function(){o=null,e.apply(null,t)},200)}});function c(){null===o||(clearTimeout(o),o=null)}function u(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(t){for(var n=t.length,e=Array(n),o=0;o<n;o++){var r=t[o];e[o]={title:r,name:r,items:[s,f]}}return e}(n.listCategories())},initialData:r,onTabChange:function(t,n){i.set(n.newTabName),a.throttle(t)},onChange:a.throttle,onAction:function(n,e){var o;"results"===e.name&&(o=e.value,t.insertContent(o),n.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}}var s={label:"Search",type:"input",name:k},f={type:"collection",name:"results"},m=t.windowManager.open(u());m.focus(k),n.hasLoaded()||(m.block("Loading emoticons..."),n.waitForLoad().then(function(){m.redial(u()),a.throttle(m),m.focus(k),m.unblock()}).catch(function(t){m.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),m.focus(k),m.unblock()}))}(t,a)}),(o=t).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:c}),o.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:c}),t.ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(t,n){return a.waitForLoad().then(function(){return g(a.listAll(),t,h.some(n))})},onAction:function(n,e,o){t.selection.setRng(e),t.insertContent(o),n.hide()}}),function(t){t.on("PreInit",function(){t.parser.addAttributeFilter("data-emoticon",function(t){!function(t){for(var n,e=0,o=t.length;e<o;e++)(n=t[e]).attr("data-mce-resize","false"),n.attr("data-mce-placeholder","1")}(t)})})}(t)})}();