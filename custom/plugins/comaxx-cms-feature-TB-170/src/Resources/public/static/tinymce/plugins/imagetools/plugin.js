!function(){"use strict";var t,e=function(t){var e=t;return{get:function(){return e},set:function(t){e=t}}},n=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=tinymce.util.Tools.resolve("tinymce.util.Tools"),o=function(t){var e=typeof t;return null===t?"null":"object"===e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e},i=function(t){return"array"===o(t)},a=function(t){return null!=t},u=function(){},c=function(t){return function(){return t}},s=function(t){return t},f=c(!1),l=c(!0),d=function(){return m},m={fold:function(t,e){return t()},isSome:f,isNone:l,getOr:s,getOrThunk:t=function(t){return t()},getOrDie:function(t){throw Error(t||"error: getOrDie called on none.")},getOrNull:c(null),getOrUndefined:c(void 0),or:s,orThunk:t,map:d,each:u,bind:d,exists:f,forall:l,filter:function(){return d()},toArray:function(){return[]},toString:c("none()")},h=function(t){var e=c(t),n=function(){return o},r=function(e){return e(t)},o={fold:function(e,n){return n(t)},isSome:l,isNone:f,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:n,orThunk:n,map:function(e){return h(e(t))},each:function(e){e(t)},bind:r,exists:r,forall:r,filter:function(e){return e(t)?o:m},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},g={some:h,none:d,from:function(t){return null==t?m:h(t)}},p={},v={exports:p};!function(t,e,n,r){var o,i;o=this,i=function(){var t={exports:{}};(function(e){var n=setTimeout;function r(){}function o(t){if("object"!=typeof this)throw TypeError("Promises must be constructed via new");if("function"!=typeof t)throw TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function i(t,e){for(;3===t._state;)t=t._value;if(0===t._state){t._deferreds.push(e);return}t._handled=!0,o._immediateFn(function(){var n,r=1===t._state?e.onFulfilled:e.onRejected;if(null===r){(1===t._state?a:u)(e.promise,t._value);return}try{n=r(t._value)}catch(t){u(e.promise,t);return}a(e.promise,n)})}function a(t,e){try{if(e===t)throw TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o){t._state=3,t._value=e,c(t);return}if("function"==typeof n){f(function(){n.apply(e,arguments)},t);return}}t._state=1,t._value=e,c(t)}catch(e){u(t,e)}}function u(t,e){t._state=2,t._value=e,c(t)}function c(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)i(t,t._deferreds[e]);t._deferreds=null}function s(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,a(e,t))},function(t){n||(n=!0,u(e,t))})}catch(t){if(n)return;n=!0,u(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(r);return i(this,new s(t,e,n)),n},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){if(0===e.length)return t([]);for(var r=e.length,o=0;o<e.length;o++)!function o(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u){u.call(a,function(t){o(i,t)},n);return}}e[i]=a,0==--r&&t(e)}catch(t){n(t)}}(o,e[o])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var r=0,o=t.length;r<o;r++)t[r].then(e,n)})},o._immediateFn="function"==typeof setImmediate?function(t){setImmediate(t)}:function(t){n(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},o._setImmediateFn=function(t){o._immediateFn=t},o._setUnhandledRejectionFn=function(t){o._unhandledRejectionFn=t},t.exports?t.exports=o:e.Promise||(e.Promise=o)})("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});var e=t.exports;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||e}},"object"==typeof e&&void 0!==n?n.exports=i():"function"==typeof t&&t.amd?t(i):(o="undefined"!=typeof globalThis?globalThis:o||self).EphoxContactWrapper=i()}(void 0,p,v);var y=v.exports.boltExport,b=function(t,e){return E(document.createElement("canvas"),t,e)},w=function(t){var e=b(t.width,t.height);return _(e).drawImage(t,0,0),e},_=function(t){return t.getContext("2d")},E=function(t,e,n){return t.width=e,t.height=n,t},I=function(t){var e=t.src;return 0===e.indexOf("data:")?U(e):R(e)},x=function(t){return new y(function(e,n){var r=URL.createObjectURL(t),o=new Image,i=function(){o.removeEventListener("load",a),o.removeEventListener("error",u)},a=function(){i(),e(o)},u=function(){i(),n("Unable to load data of type "+t.type+": "+r)};o.addEventListener("load",a),o.addEventListener("error",u),o.src=r,o.complete&&setTimeout(a,0)})},R=function(t){return new y(function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(){200===this.status&&e(this.response)},r.onerror=function(){var t;n(0===this.status?((t=Error("No access to download image")).code=18,t.name="SecurityError",t):Error("Error "+this.status+" downloading image"))},r.send()})},T=function(t){var e=t.split(","),n=/data:([^;]+)/.exec(e[0]);if(!n)return g.none();for(var r=n[1],o=e[1],i=atob(o),a=i.length,u=Math.ceil(a/1024),c=Array(u),s=0;s<u;++s){for(var f=1024*s,l=Math.min(f+1024,a),d=Array(l-f),m=f,h=0;m<l;++h,++m)d[h]=i[m].charCodeAt(0);c[s]=new Uint8Array(d)}return g.some(new Blob(c,{type:r}))},U=function(t){return new y(function(e,n){T(t).fold(function(){n("uri is not base64: "+t)},e)})},A=function(t,e,n){return(e=e||"image/png","function"==typeof HTMLCanvasElement.prototype.toBlob)?new y(function(r,o){t.toBlob(function(t){t?r(t):o()},e,n)}):U(t.toDataURL(e,n))},j=function(t){URL.revokeObjectURL(t.src)},S=Array.prototype.indexOf,O=function(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)},P=function(t,e){for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];e(i,r)&&n.push(i)}return n},k=function(t,e,n){for(var r=0,o=t.length;r<o;r++){var i=t[r];if(e(i,r))return g.some(i);if(n(i,r))break}return g.none()},M=function(t,e){return k(t,e,f)},C=function(t,e){for(var n=0,r=t.length;n<r;++n)if(!0!==e(t[n],n))return!1;return!0},F=Object.keys,L=function(t,e){for(var n=F(t),r=0,o=n.length;r<o;r++){var i=n[r];e(t[i],i)}};({generate:function(t){if(!i(t))throw Error("cases must be an array");if(0===t.length)throw Error("there must be at least one case");var e=[],n={};return O(t,function(r,o){var a=F(r);if(1!==a.length)throw Error("one and only one name per case");var u=a[0],c=r[u];if(void 0!==n[u])throw Error("duplicate key detected:"+u);if("cata"===u)throw Error("cannot have a case named cata (sorry)");if(!i(c))throw Error("case arguments must be an array");e.push(u),n[u]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=n.length;if(i!==c.length)throw Error("Wrong number of arguments to case "+u+". Expected "+c.length+" ("+c+"), got "+i);return{fold:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length!==t.length)throw Error("Wrong number of arguments to fold. Expected "+t.length+", got "+e.length);return e[o].apply(null,n)},match:function(t){var r=F(t);if(e.length!==r.length)throw Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+r.join(","));if(!C(e,function(t){var e,n;return e=r,n=t,S.call(e,n)>-1}))throw Error("Not all branches were specified when using match. Specified: "+r.join(", ")+"\nRequired: "+e.join(", "));return t[u].apply(null,n)},log:function(t){console.log(t,{constructors:e,constructor:u,params:n})}}}}),n}}).generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var B=function(t,e,n){var r=c(e.type),o=c(n),i=function(e,n){return t.then(function(t){var r;return r=(r=e)||"image/png",t.toDataURL(r,n)})};return{getType:r,toBlob:function(){return y.resolve(e)},toDataURL:o,toBase64:function(){return n.split(",")[1]},toAdjustedBlob:function(e,n){return t.then(function(t){return A(t,e,n)})},toAdjustedDataURL:i,toAdjustedBase64:function(t,e){return i(t,e).then(function(t){return t.split(",")[1]})},toCanvas:function(){return t.then(w)}}},D=function(t,e){return A(t,e).then(function(e){return B(y.resolve(t),e,t.toDataURL())})},N=function(t,e){void 0===e&&(e=2);var n=Math.pow(10,e);return Math.ceil(Math.round(t*n)/n)},H=function(t,e,n){var r=(n<0?360+n:n)*Math.PI/180,o=t.width,i=t.height,a=Math.sin(r),u=Math.cos(r),c=N(Math.abs(o*u)+Math.abs(i*a)),s=N(Math.abs(o*a)+Math.abs(i*u)),f=b(c,s),l=_(f);return l.translate(c/2,s/2),l.rotate(r),l.drawImage(t,-o/2,-i/2),D(f,e)},z=function(t,e,n){var r=b(t.width,t.height),o=_(r);return"v"===n?(o.scale(1,-1),o.drawImage(t,0,-r.height)):(o.scale(-1,1),o.drawImage(t,-r.width,0)),D(r,e)},q=function(t,e,n){return void 0===n&&(n=!1),new y(function(r){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&r({status:o.status,blob:o.response})},o.open("GET",t,!0),o.withCredentials=n,L(e,function(t,e){o.setRequestHeader(e,t)}),o.responseType="blob",o.send()})},W=function(t){try{return g.some(JSON.parse(t))}catch(t){return g.none()}},$=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],V=[{type:"not_found",message:"Failed to load image."},{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],G=function(t,e){var n,r,o=(n=function(t,e){return a(t)?t[e]:void 0},r=t,O(e,function(t,e){r=n(r,t,e)}),r);return g.from(o)},J=function(t){var e="ImageProxy HTTP error: "+M($,function(e){return t===e.code}).fold(c("Unknown ImageProxy error"),function(t){return t.message});return y.reject(e)},K=function(t){return M(V,function(e){return e.type===t}).fold(c("Unknown service error"),function(t){return t.message})},X=function(t,e){var n;return(null==e?void 0:e.type)==="application/json"&&(400===t||403===t||404===t||500===t)?(n=e,new y(function(t,e){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=function(t){e(t)},r.readAsText(n)}).then(function(t){var e="ImageProxy Service error: "+W(t).bind(function(t){return G(t,["error","type"]).map(K)}).getOr("Invalid JSON in service error message");return y.reject(e)})):J(t)},Q=function(t,e){var n=-1===t.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(t)?t:t+n+"apiKey="+encodeURIComponent(e)},Y=function(t){return t<200||t>=300},Z=function(t,e,n){return void 0===n&&(n=!1),e?q(Q(t,e),{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":e}).then(function(t){return Y(t.status)?X(t.status,t.blob):y.resolve(t.blob)}):q(t,{},n).then(function(t){return Y(t.status)?J(t.status):y.resolve(t.blob)})},tt=function(t){var e;return e=t,new y(function(t){var n=new FileReader;n.onloadend=function(){t(n.result)},n.readAsDataURL(e)}).then(function(t){return B(x(e).then(function(t){j(t);var e=b(t.naturalWidth||t.width,t.naturalHeight||t.height);return _(e).drawImage(t,0,0),e}),e,t)})},te={fromDom:function(t){if(null==t)throw Error("Node cannot be null or undefined");return{dom:t}}},tn=function(t,e){var n=t.dom;if(1!==n.nodeType)return!1;if(void 0!==n.matches)return n.matches(e);if(void 0!==n.msMatchesSelector)return n.msMatchesSelector(e);if(void 0!==n.webkitMatchesSelector)return n.webkitMatchesSelector(e);if(void 0!==n.mozMatchesSelector)return n.mozMatchesSelector(e);throw Error("Browser lacks native selectors")};"undefined"!=typeof window?window:Function("return this;")();var tr=function(t,e){var n;return n=function(t){return tn(t,e)},M(t.dom.childNodes,function(t){return n(te.fromDom(t))}).map(te.fromDom)},to=tinymce.util.Tools.resolve("tinymce.util.Delay"),ti=tinymce.util.Tools.resolve("tinymce.util.Promise"),ta=tinymce.util.Tools.resolve("tinymce.util.URI"),tu=function(t){return t.getParam("imagetools_proxy")},tc=function(t){var e,n,r=function(t){return/^[0-9\.]+px$/.test(t)};return(e=t.style.width,n=t.style.height,e||n)?r(e)&&r(n)?{w:parseInt(e,10),h:parseInt(n,10)}:null:(e=t.width,n=t.height,e&&n)?{w:parseInt(e,10),h:parseInt(n,10)}:null},ts=function(t,e){var n,r;e&&(n=t.style.width,r=t.style.height,(n||r)&&(t.style.width=e.w+"px",t.style.height=e.h+"px",t.removeAttribute("data-mce-style")),n=t.width,r=t.height,(n||r)&&(t.setAttribute("width",String(e.w)),t.setAttribute("height",String(e.h))))},tf=function(t){return{w:t.naturalWidth,h:t.naturalHeight}},tl=0,td=function(t){return tr(te.fromDom(t),"img")},tm=function(t,e){return t.dom.is(e,"figure")},th=function(t,e){return t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")},tg=function(t,e){var n=function(e){return th(t,e)&&(tb(t,e)||tw(t,e)||a(tu(t)))};return tm(t,e)?td(e).bind(function(t){return n(t.dom)?g.some(t.dom):g.none()}):n(e)?g.some(e):g.none()},tp=function(t,e){t.notificationManager.open({text:e,type:"error"})},tv=function(t){var e=t.selection.getNode(),n=t.dom.getParent(e,"figure.image");return null!==n&&tm(t,n)?td(n):th(t,e)?g.some(te.fromDom(e)):g.none()},ty=function(t,e,n){var r=e.match(/(?:\/|^)(([^\/\?]+)\.(?:[a-z0-9.]+))(?:\?|$)/i);return a(r)?t.dom.encode(r[n]):null},tb=function(t,e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new ta(n).host===t.documentBaseURI.host},tw=function(t,e){return -1!==r.inArray(t.getParam("imagetools_cors_hosts",[],"string[]"),new ta(e.src).host)},t_=function(t,e){if(tw(t,e))return Z(e.src,null,-1!==r.inArray(t.getParam("imagetools_credentials_hosts",[],"string[]"),new ta(e.src).host));if(!tb(t,e)){var n=tu(t);return Z(n+(-1===n.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src),t.getParam("api_key",t.getParam("imagetools_api_key","","string"),"string"),!1)}return I(e)},tE=function(t,e){var n,r,o=t.editorUpload.blobCache.getByUri(e.src);return o?ti.resolve(o.blob()):(n=t,r=e,g.from(n.getParam("imagetools_fetch_image",null,"function")).fold(function(){return t_(n,r)},function(t){return t(r)}))},tI=function(t,e){var n=to.setEditorTimeout(t,function(){t.editorUpload.uploadImagesAuto()},t.getParam("images_upload_timeout",3e4,"number"));e.set(n)},tx=function(t){to.clearTimeout(t.get())},tR=function(t,e,n,r,o,i,u){return n.toBlob().then(function(c){var s,f,l,d,m=t.editorUpload.blobCache;s=i.src;var h=e.type===c.type;return t.getParam("images_reuse_filename",!1,"boolean")&&(a(d=m.getByUri(s))?(s=d.uri(),f=d.name(),l=d.filename()):(f=ty(t,s,2),l=ty(t,s,1))),d=m.create({id:"imagetools"+tl++,blob:c,base64:n.toBase64(),uri:s,name:f,filename:h?l:void 0}),m.add(d),t.undoManager.transact(function(){var e=function(){t.$(i).off("load",e),t.nodeChanged(),r?t.editorUpload.uploadImagesAuto():(tx(o),tI(t,o))};t.$(i).on("load",e),u&&t.$(i).attr({width:u.w,height:u.h}),t.$(i).attr({src:d.blobUri()}).removeAttr("data-mce-src")}),d})},tT=function(t,e,n,r){return function(){return tv(t).fold(function(){tp(t,"Could not find selected image")},function(o){return t._scanForImages().then(function(){return tE(t,o.dom)}).then(function(i){return tt(i).then(n).then(function(n){return tR(t,i,n,!1,e,o.dom,r)})}).catch(function(e){tp(t,e)})})}},tU=function(t,e,n){return function(){var r=tv(t).map(function(t){var e=tc(t.dom);return e?{w:e.h,h:e.w}:null}).getOrNull();return tT(t,e,function(t){var e,r;return e=t,r=n,e.toCanvas().then(function(t){return H(t,e.getType(),r)})},r)()}},tA=function(t,e,n){return function(){return tT(t,e,function(t){var e,r;return e=t,r=n,e.toCanvas().then(function(t){return z(t,e.getType(),r)})})()}},tj=function(t,e){r.each({mceImageRotateLeft:tU(t,e,-90),mceImageRotateRight:tU(t,e,90),mceImageFlipVertical:tA(t,e,"v"),mceImageFlipHorizontal:tA(t,e,"h"),mceEditImage:function(){var n=tv(t),r=n.map(function(t){return tf(t.dom)});n.each(function(o){tg(t,o.dom).each(function(i){tE(t,o.dom).then(function(o){var i={blob:o,url:URL.createObjectURL(o)};t.windowManager.open({title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:i}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(o){var i=o.getData().imagetools.blob;n.each(function(n){r.each(function(r){var o;o=n.dom,x(i).then(function(t){var e=tf(t);return(r.w!==e.w||r.h!==e.h)&&tc(o)&&ts(o,e),URL.revokeObjectURL(t.src),i}).then(tt).then(function(n){return tR(t,i,n,!0,e,o)})})}),o.close()},onCancel:u,onAction:function(t,e){switch(e.name){case"save-state":e.value?t.enable("save"):t.disable("save");break;case"disable":t.disable("save"),t.disable("cancel");break;case"enable":t.enable("cancel")}}})})})})}},function(e,n){t.addCommand(n,e)})},tS=function(t,e,n){t.on("NodeChange",function(r){var o=n.get(),i=tg(t,r.element);o&&!i.exists(function(t){return o.src===t.src})&&(tx(e),t.editorUpload.uploadImagesAuto(),n.set(null)),i.each(n.set)})},tO=function(t){var e=[],n=function(e){return function(){return t.execCommand(e)}},r=function(){return tv(t).exists(function(e){return tg(t,e.dom).isSome()})},o=function(t){var n=function(e){return t.setDisabled(!e)};return n(r()),e=e.concat([n]),function(){e=P(e,function(t){return t!==n})}};t.on("NodeChange",function(){var t=r();O(e,function(e){return e(t)})}),t.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:n("mceImageRotateLeft"),onSetup:o}),t.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:n("mceImageRotateRight"),onSetup:o}),t.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:n("mceImageFlipVertical"),onSetup:o}),t.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:n("mceImageFlipHorizontal"),onSetup:o}),t.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:n("mceEditImage"),onSetup:o}),t.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image",onAction:n("mceImage")}),t.ui.registry.addContextMenu("imagetools",{update:function(e){return tg(t,e).map(function(t){return{text:"Edit image",icon:"edit-image",onAction:n("mceEditImage")}}).toArray()}})},tP=function(t){t.ui.registry.addContextToolbar("imagetools",{items:t.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions"),predicate:function(e){return tg(t,e).isSome()},position:"node",scope:"node"})};n.add("imagetools",function(t){var n=e(0),r=e(null);tj(t,n),tO(t),tP(t),tS(t,n,r)})}();