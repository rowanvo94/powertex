!function(){"use strict";function t(t){var e=t;return{get:function(){return e},set:function(t){e=t}}}function e(){}function n(t){return function(){return t}}function r(t){return t}function o(){return f}function i(t){var e;return e=typeof t,"array"==(null===t?"null":"object"==e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e)}var a,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),c=tinymce.util.Tools.resolve("tinymce.util.Tools"),s=n((a="function",!1)),l=n(!0),f={fold:function(t,e){return t()},isSome:s,isNone:l,getOr:r,getOrThunk:d,getOrDie:function(t){throw Error(t||"error: getOrDie called on none.")},getOrNull:n(null),getOrUndefined:n(void 0),or:r,orThunk:d,map:o,each:e,bind:o,exists:s,forall:l,filter:function(){return f},toArray:function(){return[]},toString:n("none()")};function d(t){return t()}var m=function(t){function e(){return i}function r(e){return e(t)}var o=n(t),i={fold:function(e,n){return n(t)},isSome:l,isNone:s,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:e,orThunk:e,map:function(e){return m(e(t))},each:function(e){e(t)},bind:r,exists:r,forall:r,filter:function(e){return e(t)?i:f},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return i},h={some:m,none:o,from:function(t){return null==t?f:m(t)}},g={},p={exports:g};function v(t,e){return R(document.createElement("canvas"),t,e)}function y(t){var e=v(t.width,t.height);return x(e).drawImage(t,0,0),e}function b(t){return new I(function(e,n){function r(){i.removeEventListener("load",a),i.removeEventListener("error",u)}var o=URL.createObjectURL(t),i=new Image,a=function(){r(),e(i)},u=function(){r(),n("Unable to load data of type "+t.type+": "+o)};i.addEventListener("load",a),i.addEventListener("error",u),i.src=o,i.complete&&setTimeout(a,0)})}function w(t,e,n){return e=e||"image/png",typeof HTMLCanvasElement.prototype.toBlob===a?new I(function(r,o){t.toBlob(function(t){t?r(t):o()},e,n)}):T(t.toDataURL(e,n))}function _(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}function E(t,e){return function(t,e,n){for(var r=0,o=t.length;r<o;r++){var i=t[r];if(e(i,r))return h.some(i);if(n(i,r))break}return h.none()}(t,e,s)}!function(){var t=this,e=function(){var t,e,n={exports:{}};function r(){}function o(t){if("object"!=typeof this)throw TypeError("Promises must be constructed via new");if("function"!=typeof t)throw TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(t,this)}function i(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,o._immediateFn(function(){var n,r=1===t._state?e.onFulfilled:e.onRejected;if(null!==r){try{n=r(t._value)}catch(t){return void u(e.promise,t)}a(e.promise,n)}else(1===t._state?a:u)(e.promise,t._value)})):t._deferreds.push(e)}function a(t,e){try{if(e===t)throw TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void c(t);if("function"==typeof n)return void l(function(){n.apply(e,arguments)},t)}t._state=1,t._value=e,c(t)}catch(e){u(t,e)}}function u(t,e){t._state=2,t._value=e,c(t)}function c(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)i(t,t._deferreds[e]);t._deferreds=null}function s(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function l(t,e){var n=!1;try{t(function(t){n||(n=!0,a(e,t))},function(t){n||(n=!0,u(e,t))})}catch(t){if(n)return;n=!0,u(e,t)}}t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=setTimeout,o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(r);return i(this,new s(t,e,n)),n},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){if(0===e.length)return t([]);for(var r=e.length,o=0;o<e.length;o++)!function o(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return u.call(a,function(t){o(i,t)},n),0}e[i]=a,0==--r&&t(e)}catch(t){n(t)}}(o,e[o])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var r=0,o=t.length;r<o;r++)t[r].then(e,n)})},o._immediateFn="function"==typeof setImmediate?function(t){setImmediate(t)}:function(t){e(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},o._setImmediateFn=function(t){o._immediateFn=t},o._setUnhandledRejectionFn=function(t){o._unhandledRejectionFn=t},n.exports?n.exports=o:t.Promise||(t.Promise=o);var f=n.exports;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||f}};"object"==typeof g&&void 0!==p?p.exports=e():(t="undefined"!=typeof globalThis?globalThis:t||self).EphoxContactWrapper=e()}();var I=p.exports.boltExport,x=function(t){return t.getContext("2d")},R=function(t,e,n){return t.width=e,t.height=n,t},T=function(t){return new I(function(e,n){(function(){var e=t.split(","),n=/data:([^;]+)/.exec(e[0]);if(!n)return h.none();for(var r=n[1],o=e[1],i=atob(o),a=i.length,u=Math.ceil(a/1024),c=Array(u),s=0;s<u;++s){for(var l=1024*s,f=Math.min(1024+l,a),d=Array(f-l),m=l,g=0;m<f;++g,++m)d[g]=i[m].charCodeAt(0);c[s]=new Uint8Array(d)}return h.some(new Blob(c,{type:r}))})().fold(function(){n("uri is not base64: "+t)},e)})},U=function(t){URL.revokeObjectURL(t.src)},A=Array.prototype.indexOf,j=Object.keys;function S(t,e,r){function o(e,n){return t.then(function(t){return t.toDataURL(e||"image/png",n)})}return{getType:n(e.type),toBlob:function(){return I.resolve(e)},toDataURL:n(r),toBase64:function(){return r.split(",")[1]},toAdjustedBlob:function(e,n){return t.then(function(t){return w(t,e,n)})},toAdjustedDataURL:o,toAdjustedBase64:function(t,e){return o(t,e).then(function(t){return t.split(",")[1]})},toCanvas:function(){return t.then(y)}}}function O(t,e){return w(t,e).then(function(e){return S(I.resolve(t),e,t.toDataURL())})}function P(t,e){void 0===e&&(e=2);var n=Math.pow(10,e);return Math.ceil(Math.round(t*n)/n)}function k(t,e,n){return void 0===n&&(n=!1),new I(function(r){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&r({status:o.status,blob:o.response})},o.open("GET",t,!0),o.withCredentials=n,function(t){for(var e,n=j(t),r=0,i=n.length;r<i;r++){var a=n[r];e=t[a],o.setRequestHeader(a,e)}}(e),o.responseType="blob",o.send()})}function M(t){var e="ImageProxy HTTP error: "+E(H,function(e){return t===e.code}).fold(n("Unknown ImageProxy error"),function(t){return t.message});return I.reject(e)}function C(t){return E(z,function(e){return e.type===t}).fold(n("Unknown service error"),function(t){return t.message})}function F(t){return t<200||300<=t}function L(t,e,n){var r;return void 0===n&&(n=!1),e?k((r=-1===t.indexOf("?")?"?":"&",/[?&]apiKey=/.test(t)?t:t+r+"apiKey="+encodeURIComponent(e)),{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":e}).then(function(t){var e,n;return F(t.status)?(e=t.status,"application/json"!==(null==(n=t.blob)?void 0:n.type)||400!==e&&403!==e&&404!==e&&500!==e?M(e):new I(function(t,e){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=function(t){e(t)},r.readAsText(n)}).then(function(t){var e="ImageProxy Service error: "+(function(t){try{return h.some(JSON.parse(t))}catch(t){return h.none()}})(t).bind(function(t){var e,n,r;return e=function(t,e){return null!=t?t[e]:void 0},n=t,_(["error","type"],function(t,r){n=e(n,t)}),r=n,h.from(r).map(C)}).getOr("Invalid JSON in service error message");return I.reject(e)})):I.resolve(t.blob)}):k(t,{},n).then(function(t){return F(t.status)?M(t.status):I.resolve(t.blob)})}function B(t){return new I(function(e){var n=new FileReader;n.onloadend=function(){e(n.result)},n.readAsDataURL(t)}).then(function(e){return S(b(t).then(function(t){U(t);var e=v(t.naturalWidth||t.width,t.naturalHeight||t.height);return x(e).drawImage(t,0,0),e}),t,e)})}!function(t){if(!i(t))throw Error("cases must be an array");if(0===t.length)throw Error("there must be at least one case");var e=[],n={};_(t,function(r,o){var a=j(r);if(1!==a.length)throw Error("one and only one name per case");var u=a[0],c=r[u];if(void 0!==n[u])throw Error("duplicate key detected:"+u);if("cata"===u)throw Error("cannot have a case named cata (sorry)");if(!i(c))throw Error("case arguments must be an array");e.push(u),n[u]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=n.length;if(i!==c.length)throw Error("Wrong number of arguments to case "+u+". Expected "+c.length+" ("+c+"), got "+i);return{fold:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length!==t.length)throw Error("Wrong number of arguments to fold. Expected "+t.length+", got "+e.length);return e[o].apply(null,n)},match:function(t){var r=j(t);if(e.length!==r.length)throw Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+r.join(","));if(!function(t){for(var e,n=0,o=t.length;n<o;++n)if(!0!=(e=t[n],-1<A.call(r,e)))return;return 1}(e))throw Error("Not all branches were specified when using match. Specified: "+r.join(", ")+"\nRequired: "+e.join(", "));return t[u].apply(null,n)},log:function(t){console.log(t,{constructors:e,constructor:u,params:n})}}}})}([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var D=function(t,e,n){var r=(n<0?360+n:n)*Math.PI/180,o=t.width,i=t.height,a=Math.sin(r),u=Math.cos(r),c=P(Math.abs(o*u)+Math.abs(i*a)),s=P(Math.abs(o*a)+Math.abs(i*u)),l=v(c,s),f=x(l);return f.translate(c/2,s/2),f.rotate(r),f.drawImage(t,-o/2,-i/2),O(l,e)},N=function(t,e,n){var r=v(t.width,t.height),o=x(r);return"v"===n?(o.scale(1,-1),o.drawImage(t,0,-r.height)):(o.scale(-1,1),o.drawImage(t,-r.width,0)),O(r,e)},H=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],z=[{type:"not_found",message:"Failed to load image."},{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],q={fromDom:function(t){if(null==t)throw Error("Node cannot be null or undefined");return{dom:t}}};function W(t){return t.getParam("imagetools_proxy")}function $(t){function e(t){return/^[0-9\.]+px$/.test(t)}var n=t.style.width,r=t.style.height;return n||r?e(n)&&e(r)?{w:parseInt(n,10),h:parseInt(r,10)}:null:(n=t.width,r=t.height,n&&r?{w:parseInt(n,10),h:parseInt(r,10)}:null)}function V(t){return{w:t.naturalWidth,h:t.naturalHeight}}function G(t){var e,n;return e=q.fromDom(t),n=function(t){return function(e){var n=t.dom;if(1!==n.nodeType)return!1;if(void 0!==n.matches)return n.matches("img");if(void 0!==n.msMatchesSelector)return n.msMatchesSelector("img");if(void 0!==n.webkitMatchesSelector)return n.webkitMatchesSelector("img");if(void 0!==n.mozMatchesSelector)return n.mozMatchesSelector(e);throw Error("Browser lacks native selectors")}("img")},E(e.dom.childNodes,function(t){return n(q.fromDom(t))}).map(q.fromDom)}function J(t,e){return t.dom.is(e,"figure")}function K(t,e){return t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")}function X(t,e){function n(e){return K(t,e)&&(tl(t,e)||tf(t,e)||null!=W(t))}return J(t,e)?G(e).bind(function(t){return n(t.dom)?h.some(t.dom):h.none()}):n(e)?h.some(e):h.none()}function Q(t,e){t.notificationManager.open({text:e,type:"error"})}function Y(t){var e=t.selection.getNode(),n=t.dom.getParent(e,"figure.image");return null!==n&&J(t,n)?G(n):K(t,e)?h.some(q.fromDom(e)):h.none()}function Z(t,e,n){var r=e.match(/(?:\/|^)(([^\/\?]+)\.(?:[a-z0-9.]+))(?:\?|$)/i);return null!=r?t.dom.encode(r[n]):null}function tt(t,e){var n=t.editorUpload.blobCache.getByUri(e.src);return n?tu.resolve(n.blob()):h.from(t.getParam("imagetools_fetch_image",null,"function")).fold(function(){return function(t,e){if(tf(t,e))return L(e.src,null,-1!==c.inArray(t.getParam("imagetools_credentials_hosts",[],"string[]"),new tc(e.src).host));if(tl(t,e))return(0===(n=e.src).indexOf("data:")?T:function(t){return new I(function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(){200===this.status&&e(this.response)},r.onerror=function(){var t;n(0===this.status?((t=Error("No access to download image")).code=18,t.name="SecurityError",t):Error("Error "+this.status+" downloading image"))},r.send()})})(n);var n,r=W(t);return L(r+(-1===r.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src),t.getParam("api_key",t.getParam("imagetools_api_key","","string"),"string"),!1)}(t,e)},function(t){return t(e)})}function te(t){ta.clearTimeout(t.get())}function tn(t,e,n,r,o,i,a){return n.toBlob().then(function(u){var c,s,l,f=t.editorUpload.blobCache,d=i.src,m=e.type===u.type;return t.getParam("images_reuse_filename",!1,"boolean")&&(s=null!=(l=f.getByUri(d))?(d=l.uri(),c=l.name(),l.filename()):(c=Z(t,d,2),Z(t,d,1))),l=f.create({id:"imagetools"+ts++,blob:u,base64:n.toBase64(),uri:d,name:c,filename:m?s:void 0}),f.add(l),t.undoManager.transact(function(){var e=function(){var n;t.$(i).off("load",e),t.nodeChanged(),r?t.editorUpload.uploadImagesAuto():(te(o),n=ta.setEditorTimeout(t,function(){t.editorUpload.uploadImagesAuto()},t.getParam("images_upload_timeout",3e4,"number")),o.set(n))};t.$(i).on("load",e),a&&t.$(i).attr({width:a.w,height:a.h}),t.$(i).attr({src:l.blobUri()}).removeAttr("data-mce-src")}),l})}function tr(t,e,n,r){return function(){return Y(t).fold(function(){Q(t,"Could not find selected image")},function(o){return t._scanForImages().then(function(){return tt(t,o.dom)}).then(function(i){return B(i).then(n).then(function(n){return tn(t,i,n,!1,e,o.dom,r)})}).catch(function(e){Q(t,e)})})}}function to(t,e,n){return function(){var r=Y(t).map(function(t){var e=$(t.dom);return e?{w:e.h,h:e.w}:null}).getOrNull();return tr(t,e,function(t){return t.toCanvas().then(function(e){return D(e,t.getType(),n)})},r)()}}function ti(t,e,n){return function(){return tr(t,e,function(t){return t.toCanvas().then(function(e){return N(e,t.getType(),n)})})()}}"undefined"!=typeof window||Function("return this;")();var ta=tinymce.util.Tools.resolve("tinymce.util.Delay"),tu=tinymce.util.Tools.resolve("tinymce.util.Promise"),tc=tinymce.util.Tools.resolve("tinymce.util.URI"),ts=0,tl=function(t,e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new tc(n).host===t.documentBaseURI.host},tf=function(t,e){return -1!==c.inArray(t.getParam("imagetools_cors_hosts",[],"string[]"),new tc(e.src).host)};u.add("imagetools",function(n){var r=t(0),o=t(null);c.each({mceImageRotateLeft:to(n,r,-90),mceImageRotateRight:to(n,r,90),mceImageFlipVertical:ti(n,r,"v"),mceImageFlipHorizontal:ti(n,r,"h"),mceEditImage:function(){var t=Y(n),o=t.map(function(t){return V(t.dom)});t.each(function(i){X(n,i.dom).each(function(a){tt(n,i.dom).then(function(i){var a={blob:i,url:URL.createObjectURL(i)};n.windowManager.open({title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:a}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(e){var i=e.getData().imagetools.blob;t.each(function(t){o.each(function(e){var o;o=t.dom,b(i).then(function(t){var n,r,a=V(t);return e.w===a.w&&e.h===a.h||$(o)&&a&&(n=o.style.width,r=o.style.height,(n||r)&&(o.style.width=a.w+"px",o.style.height=a.h+"px",o.removeAttribute("data-mce-style")),n=o.width,r=o.height,(n||r)&&(o.setAttribute("width",String(a.w)),o.setAttribute("height",String(a.h)))),URL.revokeObjectURL(t.src),i}).then(B).then(function(t){return tn(n,i,t,!0,r,o)})})}),e.close()},onCancel:e,onAction:function(t,e){switch(e.name){case"save-state":e.value?t.enable("save"):t.disable("save");break;case"disable":t.disable("save"),t.disable("cancel");break;case"enable":t.enable("cancel")}}})})})})}},function(t,e){n.addCommand(e,t)}),function(t){function e(e){return function(){return t.execCommand(e)}}function n(){return Y(t).exists(function(e){return X(t,e.dom).isSome()})}function r(t){function e(e){return t.setDisabled(!e)}return e(n()),o=o.concat([e]),function(){o=function(t){for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];i!==e&&n.push(i)}return n}(o)}}var o=[];t.on("NodeChange",function(){var t=n();_(o,function(e){return e(t)})}),t.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:e("mceImageRotateLeft"),onSetup:r}),t.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:e("mceImageRotateRight"),onSetup:r}),t.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:e("mceImageFlipVertical"),onSetup:r}),t.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:e("mceImageFlipHorizontal"),onSetup:r}),t.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:e("mceEditImage"),onSetup:r}),t.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image",onAction:e("mceImage")}),t.ui.registry.addContextMenu("imagetools",{update:function(n){return X(t,n).map(function(t){return{text:"Edit image",icon:"edit-image",onAction:e("mceEditImage")}}).toArray()}})}(n),n.ui.registry.addContextToolbar("imagetools",{items:n.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions"),predicate:function(t){return X(n,t).isSome()},position:"node",scope:"node"}),n.on("NodeChange",function(t){var e=o.get(),i=X(n,t.element);e&&!i.exists(function(t){return e.src===t.src})&&(te(r),n.editorUpload.uploadImagesAuto(),o.set(null)),i.each(o.set)})})}();