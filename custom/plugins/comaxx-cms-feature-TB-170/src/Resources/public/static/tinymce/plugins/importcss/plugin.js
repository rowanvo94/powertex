!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=function(t){var e=typeof t;return null===t?"null":"object"===e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e},r=function(t){return function(r){return e(r)===t}},n=r("string"),o=r("array"),i=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),c=tinymce.util.Tools.resolve("tinymce.EditorManager"),s=tinymce.util.Tools.resolve("tinymce.Env"),a=tinymce.util.Tools.resolve("tinymce.util.Tools"),u=function(t){return t.getParam("importcss_selector_converter")},l=function(t){var e=t.getParam("skin");return!1!==e&&(e||"oxide")},f=Array.prototype.push,m=function(t,e){for(var r=t.length,n=Array(r),o=0;o<r;o++){var i=t[o];n[o]=e(i,o)}return n},p=function(t){for(var e=[],r=0,n=t.length;r<n;++r){if(!o(t[r]))throw Error("Arr.flatten item "+r+" was not an array, input: "+t);f.apply(e,t[r])}return e},v=function(){var t=[],e=[],r={};return{addItemToGroup:function(t,n){r[t]?r[t].push(n):(e.push(t),r[t]=[n])},addItem:function(e){t.push(e)},toFormats:function(){return p(m(e,function(t){var e=r[t];return 0===e.length?[]:[{title:t,items:e}]})).concat(t)}}},g=/^\.(?:ephox|tiny-pageembed|mce)(?:[.-]+\w+)+$/,y=function(t){var e=s.cacheSuffix;return n(t)&&(t=t.replace("?"+e,"").replace("&"+e,"")),t},h=function(t,e){var r=l(t);if(r){var n=t.getParam("skin_url"),o=n?t.documentBaseURI.toAbsolute(n):c.baseURL+"/skins/ui/"+r,i=c.baseURL+"/skins/content/";return e===o+"/content"+(t.inline?".inline":"")+".min.css"||-1!==e.indexOf(i)}return!1},d=function(t){return n(t)?function(e){return -1!==e.indexOf(t)}:t instanceof RegExp?function(e){return t.test(e)}:t},_=function(t,e,r){var n=[],o={},i=function(e,o){var c,s=e.href;if(!(!(s=y(s))||!r(s,o)||h(t,s))){a.each(e.imports,function(t){i(t,!0)});try{c=e.cssRules||e.rules}catch(t){}a.each(c,function(t){t.styleSheet?i(t.styleSheet,!0):t.selectorText&&a.each(t.selectorText.split(","),function(t){n.push(a.trim(t))})})}};a.each(t.contentCSS,function(t){o[t]=!0}),r||(r=function(t,e){return e||o[t]});try{a.each(e.styleSheets,function(t){i(t)})}catch(t){}return n},x=function(t,e){var r,n=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(e);if(n){var o=n[1],i=n[2].substr(1).split(".").join(" "),c=a.makeMap("a,img");return(n[1]?(r={title:e},t.schema.getTextBlockElements()[o]?r.block=o:t.schema.getBlockElements()[o]||c[o.toLowerCase()]?r.selector=o:r.inline=o):n[2]&&(r={inline:"span",title:e.substr(1),classes:i}),!1!==t.getParam("importcss_merge_classes"))?r.classes=i:r.attributes={class:i},r}},P=function(t,e){return null===e||!1!==t.getParam("importcss_exclusive")},T=function(t,e,r,n){P(t,r)?n[e]=!0:r.selectors[e]=!0},b=function(t){t.on("init",function(){var e,r=v(),n={},o=d(t.getParam("importcss_selector_filter")),c=(e=t.getParam("importcss_groups"),a.map(e,function(t){return a.extend({},t,{original:t,selectors:{},filter:d(t.filter)})})),s=function(e,r){if(!(P(t,r)?e in n:e in r.selectors)){T(t,e,r,n);var o,c,s,a,l=(o=t,c=t.plugins.importcss,s=e,((a=r)&&a.selector_converter?a.selector_converter:u(o)?u(o):function(){return x(o,s)}).call(c,s,a));if(l){var f=l.name||i.DOM.uniqueId();return t.formatter.register(f,l),{title:l.title,format:f}}}return null};a.each(_(t,t.getDoc(),d(t.getParam("importcss_file_filter"))),function(t){if(!g.test(t)&&(!o||o(t))){var e=a.grep(c,function(e){return!e.filter||e.filter(t)});if(e.length>0)a.each(e,function(e){var n=s(t,e);n&&r.addItemToGroup(e.title,n)});else{var n=s(t,null);n&&r.addItem(n)}}});var l=r.toFormats();t.fire("addStyleModifications",{items:l,replace:!t.getParam("importcss_append")})})};t.add("importcss",function(t){return b(t),{convertSelectorToFormat:function(e){return x(t,e)}}})}();