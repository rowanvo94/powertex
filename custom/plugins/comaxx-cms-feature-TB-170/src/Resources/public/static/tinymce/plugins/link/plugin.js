!function(){"use strict";var t,n=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=tinymce.util.Tools.resolve("tinymce.util.VK"),r=function(t){var n=typeof t;return null===t?"null":"object"===n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n},o=function(t){return function(n){return r(n)===t}},i=function(t){return function(n){return typeof n===t}},u=o("string"),a=o("array"),l=i("boolean"),c=i("function"),f=function(){},s=function(t){return function(){return t}},m=function(t){return t},g=function(t,n){return t===n},d=s(!1),h=s(!0),v=function(){return p},p={fold:function(t,n){return t()},isSome:d,isNone:h,getOr:m,getOrThunk:t=function(t){return t()},getOrDie:function(t){throw Error(t||"error: getOrDie called on none.")},getOrNull:s(null),getOrUndefined:s(void 0),or:m,orThunk:t,map:v,each:f,bind:v,exists:d,forall:h,filter:function(){return v()},toArray:function(){return[]},toString:s("none()")},y=function(t){var n=s(t),e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},isSome:h,isNone:d,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return y(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?o:p},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},k={some:y,none:v,from:function(t){return null==t?p:y(t)}},x=Array.prototype.indexOf,b=Array.prototype.push,O=function(t,n){for(var e=t.length,r=Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r},C=function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e],e)},w=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!a(t[e]))throw Error("Arr.flatten item "+e+" was not an array, input: "+t);b.apply(n,t[e])}return n},N=function(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return k.none()},A=function(t,n,e){return void 0===e&&(e=g),t.exists(function(t){return e(t,n)})},T=function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n},P=function(t,n){return t?k.some(n):k.none()},S=function(t){var n=t.getParam("link_assume_external_targets",!1);return l(n)&&n?1:u(n)&&("http"===n||"https"===n)?n:0},_=function(t){return t.getParam("default_link_target")},R=function(t){return t.getParam("target_list",!0)},D=function(t){return t.getParam("rel_list",[],"array")},L=function(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")},E=tinymce.util.Tools.resolve("tinymce.util.Tools"),M=function(t){return u(t.value)?t.value:""},U=function(t,n){var e=[];return E.each(t,function(t){var r=u(t.text)?t.text:u(t.title)?t.title:"";if(void 0!==t.menu){var o=U(t.menu,n);e.push({text:r,items:o})}else{var i=n(t);e.push({text:r,value:i})}}),e},B=function(t){return void 0===t&&(t=M),function(n){return k.from(n).map(function(n){return U(n,t)})}},I={sanitize:function(t){return B(M)(t)},sanitizeWith:B,createUi:function(t,n){return function(e){return{name:t,type:"listbox",label:n,items:e}}},getValue:M},K=function(){return(K=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},z=Object.keys,j=Object.hasOwnProperty,V=function(t,n){for(var e=z(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}},q=function(t,n){var e,r={};return e=function(t,n){r[n]=t},V(t,function(t,r){(n(t,r)?e:f)(t,r)}),r},F=function(t,n){return j.call(t,n)},W=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),H=tinymce.util.Tools.resolve("tinymce.util.URI"),G=function(t){return t&&"a"===t.nodeName.toLowerCase()},J=function(t){return G(t)&&!!Q(t)},X=function(t,n){if(t.collapsed)return[];var e=t.cloneContents(),r=new W(e.firstChild,e),o=[],i=e.firstChild;do n(i)&&o.push(i);while(i=r.next());return o},$=function(t){return/^\w+:/i.test(t)},Q=function(t){return t.getAttribute("data-mce-href")||t.getAttribute("href")},Y=function(t,n){var e,r=["noopener"],o=t?t.split(/\s+/):[],i=function(t){return t.filter(function(t){return -1===E.inArray(r,t)})},u=n?(e=i(e=o)).length>0?e.concat(r):r:i(o);return u.length>0?E.trim(u.sort().join(" ")):""},Z=function(t,n){return tr(n=n||t.selection.getNode())?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},tt=function(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")},tn=function(t){return E.grep(t,J).length>0},te=function(t){var n=t.schema.getTextInlineElements();return 0===X(t.selection.getRng(),function(t){return 1===t.nodeType&&!G(t)&&!F(n,t.nodeName.toLowerCase())}).length},tr=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},to=function(t){var n,e,r;return n=["title","rel","class","target"],e=function(n,e){return t[e].each(function(t){n[e]=t.length>0?t:null}),n},r={href:t.href},C(n,function(t,n){r=e(r,t,n)}),r},ti=function(t,n){var e,r,o=K({},n);if(!(D(t).length>0)&&!1===L(t)){var i=Y(o.rel,"_blank"===o.target);o.rel=i||null}return k.from(o.target).isNone()&&!1===R(t)&&(o.target=_(t)),o.href=(e=o.href,"http"!==(r=S(t))&&"https"!==r||$(e)?e:r+"://"+e),o},tu=function(t,n,e,r){e.each(function(t){F(n,"innerText")?n.innerText=t:n.textContent=t}),t.dom.setAttribs(n,r),t.selection.select(n)},ta=function(t,n,e,r){tr(n)?tv(t,n,r):e.fold(function(){t.execCommand("mceInsertLink",!1,r)},function(n){t.insertContent(t.dom.createHTML("a",r,t.dom.encode(n)))})},tl=function(t,n,e){var r=t.selection.getNode(),o=Z(t,r),i=ti(t,to(e));t.undoManager.transact(function(){e.href===n.href&&n.attach(),o?(t.focus(),tu(t,o,e.text,i)):ta(t,r,e.text,i)})},tc=function(t){var n=t.dom,e=t.selection,r=e.getBookmark(),o=e.getRng().cloneRange(),i=n.getParent(o.startContainer,"a[href]",t.getBody()),u=n.getParent(o.endContainer,"a[href]",t.getBody());i&&o.setStartBefore(i),u&&o.setEndAfter(u),e.setRng(o),t.execCommand("unlink"),e.moveToBookmark(r)},tf=function(t){t.undoManager.transact(function(){var n=t.selection.getNode();tr(n)?th(t,n):tc(t),t.focus()})},ts=function(t){var n=t.class,e=t.href,r=t.rel,o=t.target,i=t.text,u=t.title;return q({class:n.getOrNull(),href:e,rel:r.getOrNull(),target:o.getOrNull(),text:i.getOrNull(),title:u.getOrNull()},function(t,n){return!1==(null===t)})},tm=function(t,n){var e=n.href;return K(K({},n),{href:H.isDomSafe(e,"a",t.settings)?e:""})},tg=function(t,n,e){var r=tm(t,e);t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,ts(r)):tl(t,n,r)},td=function(t){t.hasPlugin("rtc",!0)?t.execCommand("unlink"):tf(t)},th=function(t,n){var e=t.dom.select("img",n)[0];if(e){var r=t.dom.getParents(e,"a[href]",n)[0];r&&(r.parentNode.insertBefore(e,r),t.dom.remove(r))}},tv=function(t,n,e){var r=t.dom.select("img",n)[0];if(r){var o=t.dom.create("a",e);r.parentNode.insertBefore(o,r),o.appendChild(r)}},tp=function(t){var n;return F(t,n="items")&&void 0!==t[n]&&null!==t[n]},ty=function(t,n){return N(n,function(n){return tp(n)?ty(t,n.items):P(n.value===t,n)})},tk=function(t,n,e,r){var o=r[n],i=t.length>0;return void 0!==o?ty(o,e).map(function(n){return{url:{value:n.value,meta:{text:i?t:n.text,attach:f}},text:i?t:n.text}}):k.none()},tx=function(t,n){var e={text:t.text,title:t.title},r=function(t){var n,r,o=(n=t.url,P(e.text.length<=0,k.from(n.meta.text).getOr(n.value))),i=(r=t.url,P(e.title.length<=0,k.from(r.meta.title).getOr("")));return o.isSome()||i.isSome()?k.some(K(K({},o.map(function(t){return{text:t}}).getOr({})),i.map(function(t){return{title:t}}).getOr({}))):k.none()},o=function(t,r){var o,i=("link"===(o=r.name)?n.link:"anchor"===o?n.anchor:k.none()).getOr([]);return tk(e.text,r.name,i,t)};return{onChange:function(t,n){var i,u,a=n.name;return"url"===a?r(t()):(i=["anchor","link"],u=a,x.call(i,u)>-1)?o(t(),n):(("text"===a||"title"===a)&&(e[a]=t()[a]),k.none())}}},tb=tinymce.util.Tools.resolve("tinymce.util.Delay"),tO=tinymce.util.Tools.resolve("tinymce.util.Promise"),tC=function(t,n,e){var r=t.selection.getRng();tb.setEditorTimeout(t,function(){t.windowManager.confirm(n,function(n){t.selection.setRng(r),e(n)})})},tw=function(t){var n=t.href;return n.indexOf("@")>0&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?k.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return K(K({},t),{href:"mailto:"+n})}}):k.none()},tN=function(t,n){var e,r;return N([tw,(e=S(t),r=t.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===e&&!$(n)||0===e&&/^\s*www(\.|\d\.)/i.test(n)?k.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return K(K({},t),{href:r+"://"+n})}}):k.none()})],function(t){return t(n)}).fold(function(){return tO.resolve(n)},function(e){return new tO(function(r){tC(t,e.message,function(t){r(t?e.preprocess(n):n)})})})},tA=function(t){var n=w(O(t.dom.select("a:not([href])"),function(t){var n=t.name||t.id;return n?[{text:n,value:"#"+n}]:[]}));return n.length>0?k.some([{text:"None",value:""}].concat(n)):k.none()},tT=function(t){var n=t.getParam("link_class_list",[],"array");return n.length>0?I.sanitize(n):k.none()},tP=tinymce.util.Tools.resolve("tinymce.util.XHR"),tS=function(t){try{return k.some(JSON.parse(t))}catch(t){return k.none()}},t_=function(t){var n=function(n){return t.convertURL(n.value||n.url,"href")},e=t.getParam("link_list");return new tO(function(t){u(e)?tP.send({url:e,success:function(n){return t(tS(n))},error:function(n){return t(k.none())}}):c(e)?e(function(n){return t(k.some(n))}):t(k.from(e))}).then(function(t){return t.bind(I.sanitizeWith(n)).map(function(t){return t.length>0?[{text:"None",value:""}].concat(t):t})})},tR=function(t,n){var e=D(t);if(e.length>0){var r=A(n,"_blank");return(!1===L(t)?I.sanitizeWith(function(t){return Y(I.getValue(t),r)}):I.sanitize)(e)}return k.none()},tD=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],tL=function(t){var n=R(t);return a(n)?I.sanitize(n).orThunk(function(){return k.some(tD)}):!1===n?k.none():k.some(tD)},tE=function(t,n,e){var r=t.getAttrib(n,e);return null!==r&&r.length>0?k.some(r):k.none()},tM=function(t,n){var e=t.dom,r=te(t)?k.some(tt(t.selection,n)):k.none(),o=n?k.some(e.getAttrib(n,"href")):k.none(),i=n?k.from(e.getAttrib(n,"target")):k.none(),u=tE(e,n,"rel"),a=tE(e,n,"class");return{url:o,text:r,title:tE(e,n,"title"),target:i,rel:u,linkClass:a}},tU=function(t){var n=Z(t);return t_(t).then(function(e){var r=tM(t,n);return{anchor:r,catalogs:{targets:tL(t),rels:tR(t,r.target),classes:tT(t),anchor:tA(t),link:e},optNode:k.from(n),flags:{titleEnabled:t.getParam("link_title",!0,"boolean")}}})},tB=function(t,n){var e=t.anchor,r=e.url.getOr("");return{url:{value:r,meta:{original:{value:r}}},text:e.text.getOr(""),title:e.title.getOr(""),anchor:r,link:r,rel:e.rel.getOr(""),target:e.target.or(n).getOr(""),linkClass:e.linkClass.getOr("")}},tI=function(t,n,e){var r=t.anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),o=t.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],i=tB(t,k.from(_(e))),u=t.catalogs,a=tx(i,u);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:w([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],r,o,T([u.anchor.map(I.createUi("anchor","Anchors")),u.rels.map(I.createUi("rel","Rel")),u.targets.map(I.createUi("target","Open link in...")),u.link.map(I.createUi("link","Link list")),u.classes.map(I.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:i,onChange:function(t,n){var e=n.name;a.onChange(t.getData,{name:e}).each(function(n){t.setData(n)})},onSubmit:n}},tK=function(t){tU(t).then(function(n){return tI(n,function(e){var r=e.getData();if(!r.url.value){td(t),e.close();return}var o=function(t){return k.from(r[t]).filter(function(e){return!A(n.anchor[t],e)})},i={href:r.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},u={href:r.url.value,attach:void 0!==r.url.meta&&r.url.meta.attach?r.url.meta.attach:f};tN(t,i).then(function(n){tg(t,u,n)}),e.close()},t)}).then(function(n){t.windowManager.open(n)})},tz=function(t,n){document.body.appendChild(t),t.dispatchEvent(n),document.body.removeChild(t)},tj=function(t){var n=document.createElement("a");n.target="_blank",n.href=t,n.rel="noreferrer noopener";var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),tz(n,e)},tV=function(t,n){return t.dom.getParent(n,"a[href]")},tq=function(t){return tV(t,t.selection.getStart())},tF=function(t,n){if(n){var e=Q(n);if(/^#/.test(e)){var r=t.$(e);r.length&&t.selection.scrollIntoView(r[0],!0)}else tj(n.href)}},tW=function(t){return function(){tK(t)}},tH=function(t){return function(){tF(t,tq(t))}},tG=function(t){t.on("click",function(n){var r=tV(t,n.target);r&&e.metaKeyPressed(n)&&(n.preventDefault(),tF(t,r))}),t.on("keydown",function(n){var e,r=tq(t);r&&13===n.keyCode&&!0===(e=n).altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey&&(n.preventDefault(),tF(t,r))})},tJ=function(t,n){return t.on("NodeChange",n),function(){return t.off("NodeChange",n)}},tX=function(t){return function(n){var e=function(){return n.setActive(!t.mode.isReadOnly()&&null!==Z(t,t.selection.getNode()))};return e(),tJ(t,e)}},t$=function(t){return function(n){var e=function(){return n.setDisabled(null===Z(t,t.selection.getNode()))};return e(),tJ(t,e)}},tQ=function(t){return function(n){var e=function(n){return tn(n)||X(t.selection.getRng(),J).length>0},r=t.dom.getParents(t.selection.getStart());return n.setDisabled(!e(r)),tJ(t,function(t){return n.setDisabled(!e(t.parents))})}},tY=function(t){t.addCommand("mceLink",function(){t.getParam("link_quicklink",!1,"boolean")?t.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):tW(t)()})},tZ=function(t){t.addShortcut("Meta+K","",function(){t.execCommand("mceLink")})},t0=function(t){t.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:tW(t),onSetup:tX(t)}),t.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:tH(t),onSetup:t$(t)}),t.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return td(t)},onSetup:tQ(t)})},t1=function(t){t.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:tH(t),onSetup:t$(t)}),t.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:tW(t)}),t.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return td(t)},onSetup:tQ(t)})},t3=function(t){t.ui.registry.addContextMenu("link",{update:function(n){return tn(t.dom.getParents(n,"a"))?"link unlink openlink":"link"}})},t2=function(t){var n=function(t){t.selection.collapse(!1)},e=function(n){var e=t.selection.getNode();return n.setDisabled(!Z(t,e)),f},r=function(n){var e=Z(t),r=te(t);if(e||!r)return k.none();var o=tt(t.selection,e);return k.some(o.length>0?o:n)};t.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:tX(t)},label:"Link",predicate:function(n){return!!Z(t,n)&&t.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var n=Z(t);return n?Q(n):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(n){var e=t.selection.getNode();return n.setActive(!!Z(t,e)),tX(t)(n)},onAction:function(e){var o=e.getValue(),i=r(o);tg(t,{href:o,attach:f},{href:o,text:i,title:k.none(),rel:k.none(),target:k.none(),class:k.none()}),n(t),e.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:e,onAction:function(n){td(t),n.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:e,onAction:function(n){tH(t)(),n.hide()}}]})};n.add("link",function(t){t0(t),t1(t),t3(t),t2(t),tG(t),tY(t),tZ(t)})}();