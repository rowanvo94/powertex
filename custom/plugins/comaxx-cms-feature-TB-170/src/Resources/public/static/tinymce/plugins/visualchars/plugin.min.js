!function(){"use strict";function n(n){return function(t){return typeof t===n}}function t(n){return function(){return n}}function o(n){return n}function e(){return f}var r,i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=function(n){var t;return t=typeof n,(null===n?"null":"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t)===r},c=n("boolean"),a=n("number"),s=t((r="string",!1)),l=t(!0),f={fold:function(n,t){return n()},isSome:s,isNone:l,getOr:o,getOrThunk:d,getOrDie:function(n){throw Error(n||"error: getOrDie called on none.")},getOrNull:t(null),getOrUndefined:t(void 0),or:o,orThunk:d,map:e,each:function(){},bind:e,exists:s,forall:l,filter:function(){return f},toArray:function(){return[]},toString:t("none()")};function d(n){return n()}function m(n,t){for(var o=0,e=n.length;o<e;o++)t(n[o],o)}function v(n,t){for(var o=g(n),e=0,r=o.length;e<r;e++){var i=o[e];t(n[i],i)}}var g=Object.keys;function h(n){return n.dom.nodeValue}function p(n,t,o){!function(n,t,o){if(!(u(o)||c(o)||a(o)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",o,":: Element ",n),Error("Attribute value was not simple");n.setAttribute(t,o+"")}(n.dom,t,o)}function y(n,t){n.dom.removeAttribute(t)}function b(n,t){var o,e=null===(o=n.dom.getAttribute(t))?void 0:o;return void 0===e||""===e?[]:e.split(" ")}function k(n){return void 0!==n.dom.classList}function A(n,t){var o="";return v(n,function(n,t){o+=t}),RegExp("["+o+"]",t?"g":"")}function w(n){return'<span data-mce-bogus="1" class="mce-'+j[n]+'">'+n+"</span>"}function C(n){var t=h(n);return E(n)&&void 0!==t&&P.test(t)}function N(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")}function O(n,t){m(M(L.fromDom(t),C),function(t){var o,e,r=t.dom.parentNode;if(N(r))k(o=L.fromDom(r))?o.dom.classList.add(I):(e=b(o,"class").concat([I]),p(o,"class",e.join(" ")));else{for(var i,u=n.dom.encode(h(t)).replace(x,w),c=n.dom.create("div",null,u);i=c.lastChild;)n.dom.insertAfter(i,t.dom);n.dom.remove(t.dom)}})}function T(n,t){m(n.dom.select(_,t),function(t){var o,e;N(t)?(k(o=L.fromDom(t))?o.dom.classList.remove(I):0<(e=function(n){for(var t=[],o=0,e=n.length;o<e;o++){var r=n[o];r!==I&&t.push(r)}return t}(b(o,"class"))).length?p(o,"class",e.join(" ")):y(o,"class"),0===(k(o)?o.dom.classList:b(o,"class")).length&&y(o,"class")):n.dom.remove(t,!0)})}function D(n){var t=n.getBody(),o=n.selection.getBookmark(),e=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}}(n.selection.getNode(),t);T(n,e=void 0!==e?e:t),O(n,e),n.selection.moveToBookmark(o)}function S(n,t){var o=t.get();n.fire("VisualChars",{state:o});var e=n.getBody();(!0===t.get()?O:T)(n,e)}function B(n,t){return function(o){function e(n){return o.setActive(n.state)}return o.setActive(t.get()),n.on("VisualChars",e),function(){return n.off("VisualChars",e)}}}"undefined"!=typeof window||Function("return this;")();var V,E=function(n){return 3===n.dom.nodeType},L={fromDom:function(n){if(null==n)throw Error("Node cannot be null or undefined");return{dom:n}}},j={"\xa0":"nbsp","\xad":"shy"},P=A(j),x=A(j,!0),_=(V="",v(j,function(n){V&&(V+=","),V+="span.mce-"+n}),V),I="mce-nbsp",M=function(n,t){var o=[];return m(function(n,t){for(var o=n.length,e=Array(o),r=0;r<o;r++){var i=n[r];e[r]=t(i,r)}return e}(n.dom.childNodes,L.fromDom),function(n){o=(o=t(n)?o.concat([n]):o).concat(M(n,t))}),o},F=tinymce.util.Tools.resolve("tinymce.util.Delay");i.add("visualchars",function(n){var t,o,e,r=(t=n.getParam("visualchars_default_state",!1),{get:function(){return t},set:function(n){t=n}});function i(){return o.execCommand("mceVisualChars")}return function(n,t){n.addCommand("mceVisualChars",function(){!function(n,t){t.set(!t.get());var o=n.selection.getBookmark();S(n,t),n.selection.moveToBookmark(o)}(n,t)})}(n,r),(o=n).ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:i,onSetup:B(o,r)}),o.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:i,onSetup:B(o,r)}),e=F.debounce(function(){D(n)},300),!1!==n.getParam("forced_root_block")&&n.on("keydown",function(t){!0===r.get()&&(13===t.keyCode?D(n):e())}),n.on("remove",e.stop),n.on("init",function(){S(n,r)}),{isEnabled:function(){return r.get()}}})}();