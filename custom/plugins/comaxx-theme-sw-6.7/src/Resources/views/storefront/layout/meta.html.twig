{% sw_extends '@Storefront/storefront/layout/meta.html.twig' %}

{% set comaxxUspShowCarousel = theme_config('comaxx-header-top-bar-show-usp-carousel') %}

{% block layout_head_stylesheet %}
    {{ parent() }}

    {# Include macros for Google Fonts #}
    {% sw_include '@Storefront/storefront/macros/macros.html.twig' %}

    {# Set material symbol style #}
    {% set comaxxIconStyle = theme_config('comaxx-icon-style') %}

    {# Load the Material Symbols icon stylesheet unconditionally #}
    {# Always load rounded #}
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" />

    {# Load additional style only if it's different from rounded #}
    {% if comaxxIconStyle != 'Rounded' %}
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+{{ comaxxIconStyle }}:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" />
    {% endif %}

    {% macro google_fonts_link(fontFamily, fontWeights) %}
        {% if fontFamily %}
            <link href="https://fonts.googleapis.com/css2?family={{ fontFamily | replace({' ': '+'}) }}:wght@{{ fontWeights | replace({',': ';'}) }}&display=swap" rel="stylesheet" />
        {% endif %}
    {% endmacro %}

    {# Set font family for body text #}
    {% set comaxxSelectedFont = theme_config('sw-font-family-base') %}
    {% set comaxxFontWeights = theme_config('comaxx-font-family-weight') %}
    {% set formattedFontWeights = comaxxFontWeights | replace({',': ';'}) %}

    {# Set font family for headings #}
    {% set comaxxSelectedHeadingFont = theme_config('sw-font-family-headline') %}
    {% set comaxxHeadingFontWeights = theme_config('comaxx-heading-font-family-weight') %}
    {% set formattedHeadingFontWeights = comaxxHeadingFontWeights | replace({',': ';'}) %}

    {# Include preconnect links only if at least one font is selected #}
    {% if comaxxSelectedFont or comaxxSelectedHeadingFont %}
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    {% endif %}

    {# Call the macro directly after including the file #}
    {% if comaxxSelectedFont %}
        {{ _self.google_fonts_link(comaxxSelectedFont, formattedFontWeights) }}
    {% endif %}
    {% if comaxxSelectedHeadingFont %}
        {{ _self.google_fonts_link(comaxxSelectedHeadingFont, formattedHeadingFontWeights) }}
    {% endif %}

    {% if comaxxUspShowCarousel %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11.1.9/swiper-bundle.min.css" />
    {% endif %}
    <style>
        body {
            font-family: '{{ comaxxSelectedFont | default('Roboto') }}', sans-serif;
        }
    </style>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tiny-slider@2.9.3/dist/tiny-slider.css" />
    <!-- Include Tiny Slider JS -->
    <script src="https://cdn.jsdelivr.net/npm/tiny-slider@2.9.3/dist/min/tiny-slider.js"></script>

{% endblock %}

{% block layout_head_javascript_hmr_mode %}
    {{ parent() }}
    {% if comaxxUspShowCarousel %}
    <script src="https://cdn.jsdelivr.net/npm/swiper@11.1.9/swiper-bundle.min.js" defer></script>
    {% endif %}
{% endblock %}
